<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - morph targets - horse</title>
    <meta charset="utf-8">

</head>
<body>
<div class="c-button js-age-button" id="age01">Under 1</div>
<div class="c-button js-age-button" id="age02">1-4</div>
<div class="c-button js-age-button" id="age03">5-9</div>
<div class="c-button js-age-button" id="age04">10-15</div>
<div class="c-button js-age-button" id="age05">16+</div>
<div id="container"></div>
<div id="info">
    <a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> - WebGL morph target example
</div>

<script src="../../assets/js/three.min.js"></script>
<script src="../../assets/js/stats.min.js"></script>
<script src="../../assets/js/controls/OrbitControls.js"></script>
<script src="../../assets/js/loaders/GLTFLoader.js"></script>

<script>

    var container, stats;

    var camera, scene, renderer;

    var geometry, objects;

    var mesh;

    var sign = 1;

    var click = false;

    var age01 = document.getElementById('age01');
    var age02 = document.getElementById('age02');
    var age03 = document.getElementById('age03');
    var age04 = document.getElementById('age04');

    init();
    animate();

    function init() {

        container = document.getElementById( 'container' );

        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.01, 200 );
        camera.position.set( 0, 15, 15 );

        scene = new THREE.Scene();
        scene.background = new THREE.Color( 0x222222 );
        scene.fog = new THREE.Fog( 0x000000, 1, 15000 );

        var light = new THREE.PointLight( 0xff2200, 0.7 );
        light.position.set( 100, 100, 100 );
        scene.add( light );

        light = new THREE.PointLight( 0x22ff00, 0.7 );
        light.position.set( -100, -100, -100 );
        scene.add( light );

        light = new THREE.AmbientLight( 0x111111 );
        scene.add( light );

        var loader = new THREE.GLTFLoader();
        loader.load( '../../assets/models/gltf/animated/sphere.gltf', function ( gltf ) {

            gltf.scene.traverse( function ( node ) {

                if ( node.isMesh ) mesh = node;

            } );

            mesh.material.morphTargets = true;
            mesh.scale.set(1,1,1);
            mesh.rotation.z = Math.PI / 2;

            scene.add( mesh );

        });

        //
        console.log(mesh, 'mesh');

        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );

        //

        controls = new THREE.OrbitControls( camera, renderer.domElement );

        //

        window.addEventListener( 'resize', onWindowResize, false );
        document.addEventListener( 'mousedown', onDocumentMouseDown, false );
        document.addEventListener( 'mouseup', onDocumentMouseUp, true );
        //document.getElementsByClassName("js-button")[0].addEventListener( 'click', onButtonClick, false );

        console.log(scene);

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    function animate() {

        requestAnimationFrame( animate );
        render();

    }

    function onDocumentMouseDown( event ) {

        event.preventDefault();
        click = true;
        // console.log(click);

    }
    function onDocumentMouseUp( event ) {

        event.preventDefault();
        click = false;
        // console.log(click);

    }

    function onButtonClick ( event ) {
        console.log('unicorn');

    }

    function render() {
        //console.log(click, 'click');

        if(click){

//            if ( mesh !== undefined ) {
//
//                // mesh.rotation.y += 0.01;
//              //  console.log( mesh.morphTargetInfluences,'morph');
//
//                mesh.morphTargetInfluences[ 3 ] = mesh.morphTargetInfluences[ 3 ] + 0.01 * sign;
//
//                if ( mesh.morphTargetInfluences[ 3 ] <= 0 || mesh.morphTargetInfluences[ 3 ] >= 1 ) {
//
//                    sign *= -1;
//
//                }
//
//            }

        }
        age01.onclick = function () {
            console.log('button1');
            if ( mesh !== undefined ) {
                console.log(mesh.morphTargetInfluences,'influences');

                mesh.morphTargetInfluences = [0,0,0,0];
                // mesh.rotation.y += 0.01;
                //  console.log( mesh.morphTargetInfluences,'morph');
                while(mesh.morphTargetInfluences[0]!== 1){

                    mesh.morphTargetInfluences[ 0 ] = mesh.morphTargetInfluences[ 0 ] + 0.5*sign;

                }


//            if ( mesh.morphTargetInfluences[ 2 ] <= 0 || mesh.morphTargetInfluences[ 2 ] >= 1 ) {
//
//                sign *= -1;
//
//            }

            }
        }

        renderer.render( scene, camera );

    }



    age02.onclick = function () {
        console.log('button1');
        if ( mesh !== undefined ) {
            console.log(mesh.morphTargetInfluences);

            // mesh.rotation.y += 0.01;
            //  console.log( mesh.morphTargetInfluences,'morph')
            mesh.morphTargetInfluences = [0,0,0,0];
            mesh.morphTargetInfluences[ 1 ] = mesh.morphTargetInfluences[ 1 ] + sign;

//            if ( mesh.morphTargetInfluences[ 3 ] <= 0 || mesh.morphTargetInfluences[ 3 ] >= 1 ) {
//
//                sign *= -1;
//
//            }

        }
    }
    age03.onclick = function () {
        console.log('button1');
        if ( mesh !== undefined ) {
            console.log(mesh.morphTargetInfluences);

            // mesh.rotation.y += 0.01;
            //  console.log( mesh.morphTargetInfluences,'morph')
            mesh.morphTargetInfluences = [0,0,0,0];
            mesh.morphTargetInfluences[ 2 ] = mesh.morphTargetInfluences[ 2 ] + sign;

//            if ( mesh.morphTargetInfluences[ 3 ] <= 0 || mesh.morphTargetInfluences[ 3 ] >= 1 ) {
//
//                sign *= -1;
//
//            }

        }
    }
    age04.onclick = function () {
        console.log('button1');
        if ( mesh !== undefined ) {
            console.log(mesh.morphTargetInfluences);

            // mesh.rotation.y += 0.01;
            //  console.log( mesh.morphTargetInfluences,'morph')
            mesh.morphTargetInfluences = [0,0,0,0];
            mesh.morphTargetInfluences[ 3 ] = mesh.morphTargetInfluences[ 3 ] + 0.1 * sign;

//            if ( mesh.morphTargetInfluences[ 3 ] <= 0 || mesh.morphTargetInfluences[ 3 ] >= 1 ) {
//
//                sign *= -1;
//
//            }

        }
    }



</script>

</body>
</html>